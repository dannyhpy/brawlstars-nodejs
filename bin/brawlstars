#!/usr/bin/env node

const package = require('../package.json')
const BrawlStars = require('..')

const token = process.env.TOKEN
if (token == null) {
  // TODO: Save and retrieve token locallly
  // via `brawlstars token set <...>` & `brawlstars token get`
  console.error('The TOKEN environment variable is missing')
  process.exit(1)
}

const bs = new BrawlStars.Client(token)

const replies = {
  commandNotFound () {
    console.error('Command not found.')
    console.error('See \'brawlstars help\' for more information.')
    process.exit(1)
  },

  errorOccured (error) {
    console.error('An error occured.')
    console.error(error)
    process.exit(1)
  }
}

switch (process.argv[2]) {
  case 'h':
  case 'help':
  case '-h':
  case '--help':
    break

  case 'v':
  case 'version':
  case '-v':
  case '--version':
    console.log(`v${package.version}`)
    break

  case 'players':
    switch (process.argv[3]) {
      case 'exists':
        bs.players.fetch(process.argv[4])
          .then(player => {
            console.log(`A player called '${player.name}' exists with this tag.`)
          })
          .catch(replies.errorOccured)
        break

      default:
        replies.commandNotFound()
    }

  default:
    replies.commandNotFound()
}